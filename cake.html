<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>材料價格計算</title>
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.7.0/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.7.0/firebase-firestore.js";
      
      // Your Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyC_S1tr4bL7oJE4q_erTVzYZ6MIsBQDF1Y",
        authDomain: "dessert-515c4.firebaseapp.com",
        databaseURL: "https://dessert-515c4-default-rtdb.firebaseio.com",
        projectId: "dessert-515c4",
        storageBucket: "dessert-515c4.firebasestorage.app",
        messagingSenderId: "710755169317",
        appId: "1:710755169317:web:0445013be1c00ac14dfbcc",
        measurementId: "G-77VWS6FC67"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Expose db to the global window object
      window.db = db;
    </script>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { width: 500px; margin: 0 auto; }
        .form-group { margin-bottom: 10px; }
        input { width: 100%; padding: 8px; }
        button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h2>材料價格計算器</h2>
        <div id="app">
            <div class="form-group">
                <label for="date">購買日期</label>
                <input type="date" v-model="date" id="date">
            </div>
            <div class="form-group">
                <label for="name">材料名稱</label>
                <input type="text" v-model="name" id="name">
            </div>
            <div class="form-group">
                <label for="weight">公克數</label>
                <input type="number" v-model="weight" id="weight" step="0.1">
            </div>
            <div class="form-group">
                <label for="amount">購買金額 (NTD)</label>
                <input type="number" v-model="amount" id="amount" step="0.01">
            </div>
            <div class="form-group">
                <button @click="calculateAndSave">計算並儲存</button>
            </div>
            <div v-if="pricePerGram !== null">
                <p>每克價格: {{ pricePerGram }} NTD/g</p>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                date: '',
                name: '',
                weight: 0,
                amount: 0,
                pricePerGram: null
            },
            methods: {
                calculateAndSave() {
                    if (this.weight > 0 && this.amount > 0) {
                        // 計算每克價格
                        this.pricePerGram = (this.amount / this.weight).toFixed(2);
                        this.saveData();
                    } else {
                        alert('請確認輸入的數據正確');
                    }
                },
                async saveData() {
                    try {
                        // 將資料儲存到 Firebase Firestore
                        const docRef = await addDoc(collection(window.db, "purchases"), {
                            date: this.date,
                            name: this.name,
                            weight: this.weight,
                            amount: this.amount,
                            pricePerGram: this.pricePerGram
                        });
                        alert("資料儲存成功！");
                    } catch (e) {
                        alert("儲存資料時出錯: " + e);
                    }
                }
            }
        });
    </script>
</body>
</html>