<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>材料價格計算</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { width: 500px; margin: 0 auto; }
        .form-group { margin-bottom: 10px; }
        input { width: 100%; padding: 8px; }
        button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h2>材料價格計算器</h2>
        <div id="app">
            <div class="form-group">
                <label for="date">購買日期</label>
                <input type="date" v-model="date" id="date">
            </div>
            <div class="form-group">
                <label for="name">材料名稱</label>
                <input type="text" v-model="name" id="name">
            </div>
            <div class="form-group">
                <label for="weight">公克數</label>
                <input type="number" v-model="weight" id="weight" step="0.1">
            </div>
            <div class="form-group">
                <label for="amount">購買金額 (NTD)</label>
                <input type="number" v-model="amount" id="amount" step="0.01">
            </div>
            <div class="form-group">
                <button @click="calculate">計算</button>
                <button @click="saveData">儲存</button>
            </div>
            <div v-if="pricePerGram !== null">
                <p>每克價格: {{ pricePerGram }} NTD/g</p>
            </div>
            <h3>歷史記錄</h3>
            <ul>
                <li v-for="(entry, index) in history" :key="index">
                    {{ entry.date }} - {{ entry.name }}: {{ entry.pricePerGram }} NTD/g
                </li>
            </ul>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // 引入 Firebase 套件
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        // import { getDatabase, ref, set, push, get } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
		import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
		import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";



        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyC_S1tr4bL7oJE4q_erTVzYZ6MIsBQDF1Y",
            authDomain: "dessert-515c4.firebaseapp.com",
            databaseURL: "https://dessert-515c4-default-rtdb.firebaseio.com",
            projectId: "dessert-515c4",
            storageBucket: "dessert-515c4.appspot.com",
            messagingSenderId: "710755169317",
            appId: "1:710755169317:web:5acc04f9b6cae3774dfbcc",
            measurementId: "G-WKQ3DVBHT5"
        };

        // 初始化 Firebase
        // const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);
        const db = getDatabase(app);

        // Vue 實例
		new Vue({
			el: '#app',
			data: {
				userData: null,
				date: '',
				name: '',
				weight: 0,
				amount: 0,
				pricePerGram: null,
				history: []
			},
			methods: {
				async fetchUserData(uid) {
					try {
						const userRef = ref(db, 'users/' + uid);
						const snapshot = await get(userRef);
						if (snapshot.exists()) {
							this.userData = snapshot.val();
							console.log("讀取使用者資料:", this.userData);
						} else {
							console.log("沒有找到使用者資料");
						}
					} catch (error) {
						console.error("讀取失敗：", error);
					}
				},
				fetchData() {
					get(ref(db, 'materials'))
						.then((snapshot) => {
							if (snapshot.exists()) {
								this.history = Object.values(snapshot.val());
							} else {
								console.log("沒有材料資料");
							}
						})
						.catch((error) => {
							console.error("讀取材料資料失敗：", error);
						});
				}
			},
			mounted() {
				const uid = localStorage.getItem("uid");
				if (uid) {
					this.fetchUserData(uid);
				} else {
					alert("未登入，請先登入！");
					window.location.href = "./cakeindex.html";
				}
				this.fetchData();
			}
		});
    </script>
</body>
</html>
